# 线程池配置多少线程合适

### 问题背景：

性能思考：随着请求越来越多,直到不能有效提供服务，我们往往有两个选择：1.升级硬件 2.通过优化算法，提高程序并行度，也就是提升CPU和IO的利用率从而达到硬件综合最大化利用率
当然，如果单机性能已经优化到没有什么可以想象的空间了。那么我们就要考虑分布式，用多台机器作为集群，对外一起提供服务（注意这里我说的是集群，是从某一个具体的服务来说）。数据库有心梗瓶颈的话采用分库分表等等。

### 指标：
我们优化的指标一般是延迟和吞吐量。那么我们所有的优化手段都是为了降低延迟和提升吞吐量。
为了降低延迟我们可以：优化业务主流程；优化算法；增加缓存；对下游做限时降级；等等。


### 目标与策略
本文关注的单机性能提升的其中一个方法：提高程序并行度来提升吞吐量
本文关注的单机性能提升的策略：通过提高程序并行度，来达到硬件综合最大化利用率。对于IO密集型或者说（非纯CPU密集型的应用）使用线程池来提高任务并行度，使CPU利用率尽量最大化。但是同时工程上我们要关注指标的同时，不能往百分之百去调整，以为 要预留出一部分性能给意外情况使用。

### 实战

#### 理论：
##### 操作系统流水线作业，IO与CPU耗时比

##### 阿姆达尔公式

##### 理想很丰满，现实很骨感：
要考虑，Dokcer、虚机、多个应用部署在同一个机器上的情况。以及应用之间相互影响。所以我们不能只理论计算，而是要根据理论计算来进行合理估值。然后进行实际环境压测。


##### 压测，从两头往中间压。
压测案例：PUSH消息系统

